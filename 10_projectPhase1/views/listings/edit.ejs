<% layout('/layouts/boilerplate') %>

<div class="container mt-4">
  <h2 class="text-center mb-4">Edit Listing</h2>

  <!-- Image Preview Section -->
  <% if (listing.image && listing.image.url) { %>
    <div class="text-center mb-3">
      <img 
        src="<%= listing.image.url %>" 
        alt="Listing Image" 
        class="img-thumbnail rounded shadow-sm" 
        style="max-width: 200px; height: auto;"
      >
    </div>
  <% } %>

  <!-- Form Section -->
  <form method="POST" action="/listings/<%= listing._id %>?_method=PUT"  enctype="multipart/form-data" class="needs-validation" novalidate>

    <div class="mb-3">
      <label for="title" class="form-label">Title:</label>
      <input type="text" class="form-control" id="title" name="listing[title]" value="<%= listing.title %>" required>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label">Description:</label>
      <textarea class="form-control" id="description" name="listing[description]" rows="4"><%= listing.description %></textarea>
    </div>

    <div class="mb-3">
      <label for="price" class="form-label">Price (₹):</label>
      <input type="number" class="form-control" id="price" name="listing[price]" value="<%= listing.price %>" required>
    </div> 

    <div class="mb-3">
      <label for="location" class="form-label">Location:</label>
      <input type="text" class="form-control" id="location" name="listing[location]" value="<%= listing.location %>" required>
    </div>

    <div class="mb-3">
      <label for="country" class="form-label">Country:</label>
      <input type="text" class="form-control" id="country" name="listing[country]" value="<%= listing.country %>" required>
    </div>

    <div class="mb-3">
      <label for="image" class="form-label">Upload New Image:</label>

      <!-- ✅ FIXED FIELD NAME (ONLY CHANGE MADE) -->
      <input type="file" class="form-control" id="image" name="image">

    </div>

    <button type="submit" class="btn btn-success w-100">Update Listing</button>
  </form>
</div>